package com.poynt.payment.app.ui;import com.poynt.log.Logger;import com.poynt.payment.app.listener.ModelP5ViewListener;import com.poynt.payment.app.provider.ModelP5ActivityProvider;import com.poynt.core.CardStateHandler;import com.poynt.core.cardstates.CardCanceledState;import com.poynt.core.cardstates.CardFinishedState;import com.poynt.core.cardstates.CardInsertedState;import com.poynt.core.cardstates.CardProcessingState;import com.poynt.core.cardstates.CardReadingState;import com.poynt.core.cardstates.WelcomeScreenState;import com.poynt.core.events.MessageEvent;import org.greenrobot.eventbus.EventBus;import org.greenrobot.eventbus.Subscribe;import org.greenrobot.eventbus.ThreadMode;public class ModelP5ViewImpl extends ModelP5ActivityProvider implements ModelP5ViewListener {    private static final String TAG = "ModelP5ViewImpl";    private ModelP5Fragment mMainView;    private CardStateHandler mCardStateableHandler;    public static int count = 0;    public ModelP5ViewImpl(ModelP5Fragment view, CardStateHandler stateHandler) {        mMainView = view;        mCardStateableHandler = stateHandler;    }    @Override    public void onViewResumed() {        EventBus.getDefault().register(this);    }    @Override    public void onViewPaused() {        EventBus.getDefault().unregister(this);    }    @Override    public void onViewStoped() {    }    @Subscribe(threadMode = ThreadMode.MAIN)    public void onMessageEvent(MessageEvent event) {        Logger.d(TAG, "onMessageEvent ");        toggleButtonStatus(mMainView.mButtonCancel.isEnabled() ? false : true);    }    @Override    public void setNewState() {        Logger.d(TAG, "setNewState " + count);        if(count <= 4) {            if (count == 0) {                mCardStateableHandler.setNewState(CardInsertedState.getInstance());            } else if (count == 1) {                mCardStateableHandler.setNewState(CardReadingState.getInstance());            }  else if (count == 2) {                mCardStateableHandler.setNewState(CardProcessingState.getInstance());            } else if (count == 3) {                mCardStateableHandler.setNewState(CardFinishedState.getInstance());            } else if (count == 4) {                mCardStateableHandler.setNewState(CardCanceledState.getInstance());            }        } else {            mCardStateableHandler.setNewState(WelcomeScreenState.getInstance());            count = -1;        }        count++;    }    @Override    public void setCancelState() {        Logger.d(TAG, "setCancelState ");        mCardStateableHandler.setNewState(CardCanceledState.getInstance());        count = 5;    }    @Override    public void setWelcomeState() {        Logger.d(TAG, "setWelcomeState ");        mCardStateableHandler.setNewState(WelcomeScreenState.getInstance());        count = 0;    }    public void toggleButtonStatus(boolean isEnabled) {        mMainView.mButtonCancel.setEnabled(isEnabled);    }    public void toggleOkStatus(boolean isEnabled) {        mMainView.mButtonOk.setEnabled(isEnabled);    }}